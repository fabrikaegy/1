<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Checkout - FABRIKA</title>

<style>
body {
    background:#ffffff;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    margin:0;
    padding:0;
    color:#000;
}

.container {
    max-width:480px;
    margin:0 auto;
    padding:20px;
}

.section-title {
    font-size:28px;
    font-weight:700;
    margin-bottom:10px;
}

.subtext {
    color:#666;
    font-size:14px;
    margin-bottom:20px;
}

.box {
    border:1px solid #d9d9d9;
    border-radius:12px;
    padding:16px;
    background:#f9f9f9;
    margin-bottom:20px;
}

.radio-row {
    display:flex;
    align-items:center;
    padding:12px;
    background:white;
    border-radius:12px;
    border:2px solid #d9d9d9;
    margin-bottom:10px;
}

.radio-row input {
    width:20px;
    height:20px;
    margin-right:12px;
}

.label {
    font-size:16px;
}

.input { height:48px; padding:12px; border-radius:8px; border:1px solid #d6d6d6; font-size:15px; width:100%; background:#ffffff; box-sizing:border-box; margin-bottom:14px; }

.row-2 {
    display:flex;
    gap:12px;
}

.order-box {
    border-radius:12px;
    background:white;
    border:1px solid #d9d9d9;
    padding:16px;
}

.order-item {
    display:flex;
    align-items:center;
    padding:10px 0;
    border-bottom:1px solid #eaeaea;
}

.order-item img {
    width:70px;
    height:70px;
    border-radius:10px;
    margin-right:15px;
    object-fit:cover;
}

.summary-line {
    display:flex;
    justify-content:space-between;
    margin:8px 0;
    font-size:16px;
}

.total-line {
    display:flex;
    justify-content:space-between;
    font-size:22px;
    margin-top:15px;
    font-weight:700;
}

.button { width:100%; height:48px; padding:12px; background:#007bff; color:white; border-radius:8px; font-size:17px; font-weight:600; text-align:center; box-sizing:border-box; margin-top:20px; cursor:pointer; }
</style>

<!-- EMAILJS INIT -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
   (function(){
      emailjs.init("tTQoX_xpaaaEM63hP"); 
   })();
</script>

</head>

<body>
<div class="container" style="max-width:430px; padding:16px;">

    <h1 class="section-title">Payment</h1>
    <p class="subtext">All transactions are secure and encrypted.</p>

    <div class="box">
        <div class="radio-row">
            <input type="radio" checked>
            <span class="label">Cash on Delivery (COD)</span>
        </div>
    </div>

    <h2 class="section-title" style="font-size:22px; margin-top:25px;">Delivery</h2>

    <select class="input" style="height:48px; font-size:15px;">
        <option>Egypt</option>
    </select>

    <input class="input" placeholder="First name (optional)">
    <input class="input" placeholder="Last name">
    <input class="input" placeholder="Address">

    <input class="input" placeholder="Apartment, suite, etc. (optional)">
    <input class="input" placeholder="City">

    <select class="input" style="height:48px; font-size:15px;">
        <option>Cairo</option>
    </select>

    <input class="input" placeholder="Postal code (optional)">
    <input class="input" placeholder="Phone">

    <div class="order-box">
        <h2 class="section-title" style="font-size:22px;">Order summary</h2>

        <div id="order-items"></div>

        <div class="summary-line">
            <span>Subtotal</span>
            <span id="subtotal-price">EGP 0.00</span>
        </div>

        <div class="summary-line">
            <span>Shipping</span>
            <span>EGP 80.00</span>
        </div>

        <div class="total-line">
            <span>Total</span>
            <span id="total-price">EGP 0.00</span>
        </div>
    </div>

    <div class="button">Complete order</div>

</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const cartItems = JSON.parse(localStorage.getItem("cartItems") || "[]");
    const orderContainer = document.getElementById("order-items");
    const subtotalDisplay = document.getElementById("subtotal-price");
    const totalDisplay = document.getElementById("total-price");

    let subtotal = 0;

    cartItems.forEach(item => {
        const price = parseFloat(item.price.replace("LE ", ""));
        const lineTotal = price * item.quantity;
        subtotal += lineTotal;

        const div = document.createElement("div");
        div.className = "order-item";

        div.innerHTML = `
            <img src="${item.image}">
            <div>
                <div style="font-weight:600">${item.title}</div>
                <div style="color:#666; font-size:14px;">${item.size}</div>
            </div>
            <div style="margin-left:auto; font-weight:600;">EGP ${lineTotal.toFixed(2)}</div>
        `;
        orderContainer.appendChild(div);
    });

    subtotalDisplay.textContent = "EGP " + subtotal.toFixed(2);
    totalDisplay.textContent = "EGP " + (subtotal + 80).toFixed(2);
});
</script>

<!-- EMAILJS ORDER SEND WITH VALIDATION AND REDIRECT -->
<script>
document.querySelector(".button").addEventListener("click", sendOrder);

function sendOrder() {
    const first = document.querySelector("input[placeholder='First name (optional)']").value;
    const last = document.querySelector("input[placeholder='Last name']").value.trim();
    const address = document.querySelector("input[placeholder='Address']").value.trim();
    const apt = document.querySelector("input[placeholder='Apartment, suite, etc. (optional)']").value;
    const city = document.querySelector("input[placeholder='City']").value;
    const postal = document.querySelector("input[placeholder='Postal code (optional)']").value;
    const phone = document.querySelector("input[placeholder='Phone']").value.trim();

    // Validation: required fields
    if (last === "" || address === "" || phone === "") {
        alert("Please enter Last Name, Address, and Phone number before confirming the order.");
        return; // Stop sending
    }

    const fullName = `${first} ${last}`.trim();
    const fullAddress = `${address}, ${apt}, ${city}, ${postal}`;

    const items = JSON.parse(localStorage.getItem("cartItems") || "[]");

    if (items.length === 0) {
        alert("Your cart is empty.");
        return;
    }

    let orderList = "";
    items.forEach(i => {
        orderList += `${i.title} - ${i.size} - Qty: ${i.quantity} - Price: ${i.price}\n`;
    });

    const subtotal = document.getElementById("subtotal-price").innerText;
    const total = document.getElementById("total-price").innerText;

    const templateParams = {
        name: fullName,
        address: fullAddress,
        phone: phone,
        order: orderList,
        subtotal: subtotal,
        total: total
    };

    emailjs.send("service_hhx9jiw", "template_srnf68y", templateParams, "tTQoX_xpaaaEM63hP")
    .then(() => {
        alert("Order sent successfully! We will contact you soon.");
        localStorage.removeItem("cartItems");

        // Redirect to home page after 1.5 seconds
        setTimeout(() => {
            window.location.href = "home.html"; // change if your home page file is different
        }, 1500);
    })
    .catch((error) => {
        alert("Failed to send. Please try again.");
        console.error(error);
    });
}
</script>

</body>
</html>
